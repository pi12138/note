# Python中的协议

- 一些魔法方法的使用
- Python 数据模型的哲学是尽量支持基本协议。

## 基本序列协议

- 获取长度实现`__len__`, 
- 定义`__getitem__`方法，，这样足够访问元素、迭代和使用 in 运算符了
	- 鉴于序列协议的重要性，如果没有 `__iter__` 和 `__contains__` 方法，Python 会调用 `__getitem__` 方法，设法让迭代和 in 运算符可用。
	- 用下标访问序列中的元素时 obj[index] ，其实调用了`obj.__getitem__(index)`
- 定义`__setitem__`方法，可以使序列可变

## 动态存取属性

- 属性查找失败后，解释器会调用`__getattr__`方法
- Python中的属性查找流程，例如 obj.x
	- 先检查 obj 实例中有没有名为 x 的属性
	- 如果没有就到 `obj.__class__`(对象所属的类)
	- 如果还没有，就顺着继承树查找
	- 如果依旧找不到，调用 obj 所属类中定义的 `__getattr__` 方法，传入self和属性名称的字符串

## 可散列对象

- `__hash__`
- `__eq__`

## 格式化输出

- `__format__`

## 标准迭代器接口

- `__next__`,返回下一个可用的元素，如果没有元素了，抛出 StopIteration 异常。
- `__iter__`,返回 self，以便在应该使用可迭代对象的地方使用迭代器，例如在 for 循环中。

## 上下文管理器协议

- `__enter__`with 语句开始运行时，会在上下文管理器对象上调用 `__enter__` 方法。
- `__exit__`with 语句运行结束后，会在上下文管理器对象上调用 `__exit__` 方法，以此扮演 finally 子句的角色。